/**
 * 2020.04.17
 * v 2.1.1
 */
var enernet = enernet || {};
enernet.namespace = function(ns_string) {
	var parts = ns_string.split('.'), parent = enernet, i;
	if (parts[0] === "enernet") {
		parts = parts.slice(1);
	}
	for (i = 0; i < parts.length; i += 1) {
		if (typeof parent[parts[i]] === "undefined") {
			parent[parts[i]] = {};
		}
		parent = parent[parts[i]];
	}
	return parent;
}

enernet.namespace('enernet.modules.api');
//api === ENERNET.modules.api; // true


enernet.modules.api = function() {
	//	======================================================================	//
	//	private
	//	api url ê¸°ë³¸ ì£¼ì†Œ
	var _apiUrl = "https://www.egservice.co.kr:3187";
	
	//	api ìš”ì²­ì‹œ ì‚¬ìš© ë˜ëŠ” í•¨ìˆ˜
	//	async false ë™ê¸°	url, data, func, '', '', 'false'		==>	''ì´ê²ƒì€ falseë¡œ ê°„ì£¼í•˜ê¸°ë•Œë¬¸ì— ì¡°ì‹¬íˆ ì‚¬ìš©í• ê²ƒ
	//	async true ë¹„ë™ê¸°	url, data, func
	var _apiCallPost = function(url, data, successCallBack, errorCallBack, async){
		
		
		if(async == undefined || async == '') {
			async = true;
		}else{
			if(async == 'false'){
				async = false;
			}else{
				async = true;
			}
		}
		
		
		$.ajax({
			url :url,
			type: 'POST',
			dataType : 'json',
			data : data,
			async : async,
			success : function(data){
				console.log("success : " + url);
				console.log(data);
				if(successCallBack == undefined || successCallBack == ''){
					
					console.log('success callback undefined');
				
				}else{
					successCallBack(data);
				}
				
			},
			error : function(e){
				$('.wrap-loading').addClass('display-none');
				if(errorCallBack == undefined || errCallBack == ''){
					//console.log("error");
					//console.log(data);
					var _obj = {}
					_obj.data = data;
					_obj.status = e.status;
					_obj.statusText = e.statusText;
					_obj.requestUrl = url;
					
					_ajaxCall("../ajax/error", _obj);
					
				}else{
					errorCallBack(e);
				} 
			}
		});
	}; 
	
	
	//	api call	async
	function _apiCallAsyncLoading(_url, _data){
		var _returnData = null;
		
		$.ajax({
			url : _url,
			type: 'POST',
			dataType : 'json',
			data : _data,
			async : false,
			beforeSend : function(){
				$('div.wrap-loading').removeClass('display-none');
			},
			success : function(response){
				_returnData = response;
			},
			complete : function(){
				$('.wrap-loading').addClass('display-none');
			},
			error : function(e){
				$('.wrap-loading').addClass('display-none');
				
				var _obj = {}
				_obj.data = _data;
				_obj.status = e.status;
				_obj.statusText = e.statusText;
				_obj.requestUrl = _url;
				
				_ajaxCall("../ajax/error", _obj);
			}
		});
		
		return _returnData;
	}
	
	//	private	error ë¡œê·¸ ì²˜ë¦¬
	function _ajaxCall(_url, _data){
			
		$.ajax({ 
			 
			url : _url, 
			contentType : 'application/json;charset=utf-8;',
			type : 'POST',
			data : JSON.stringify(_data), 
			success : function(data){ 
			}, 
			error: function(e){ 
				//console.log(e) 
				//alert('ì„œë²„ì™€ ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤'); 
			} 
		});
	}
	
	//	======================================================================	//
	
	
	
	
	
	
	//	======================================================================	//

	//	form ì „ì†¡		url ê³¼ formname ê°’ í•„ìš”	
	function _ajaxFormPostAsync( requestUrl, formName){
		var _returnData = null;
		
		var _form = $("form[name="+formName+"]")[0];
		
		var _formData = new FormData(_form)
		
		$.ajax({
			url : requestUrl,
			type: 'post',
			processData: false,
            contentType: false,
			data : _formData,
			async : false,
			beforeSend : function(){
				$('div.wrap-loading').removeClass('display-none');
			},
	    	success : function(response){
	    		//console.log(2)
				_returnData = response;
			},
			complete : function(){
				$('.wrap-loading').addClass('display-none');
			},
			error : function(e){
				//console.log(_form)
				alert('ì„œë²„ ì „ì†¡ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤');
				var _obj = {}
				_obj.status = e.status;
				_obj.statusText = e.statusText;
				_obj.requestUrl = requestUrl;
				_obj.data = {};
				
				var _formNameData = {};
				
				var _inputNameArr = $(_form).find('input[name]');
				for( var i=0; i<_inputNameArr.length; i++){
					var _inputName = _inputNameArr[i].name;
					
					if($("#"+ _inputName).length == 0){
						continue;
					}else{
						var _inputData = $("#"+ _inputName).val();
						_formNameData[_inputName] = _inputData;
					}
				}
				
				_obj.data = _formNameData;
				
	    		_ajaxCall("../ajax/error", _obj);
	    	}
		});
		
		return _returnData;
	}
	//	======================================================================	//
		
	
	
	//	í˜„ì¬ ì‚¬ìš©ëŸ‰ - ë‹¨ì§€ ê´€ë ¨ ì •ë³´(ì‚¬ìš©ëŸ‰ì˜ ì´í•©, 
	var _getAdminUsageCurrent = function(SeqAdmin, successCallBack, errorCallBack, async){
		var url = _apiUrl + "/api/GetAdminUsageCurrent";
		var data = {};
		data.SeqAdmin = SeqAdmin;
		_apiCallPost(url, data, successCallBack, errorCallBack, async);
	}
	

	//	ì¼ê°„ ì‚¬ìš©ëŸ‰
	var _getUsageOfOneDay = function(SeqSite, SeqMeter, Year, Month, Day, successCallBack, errorCallBack, async){
		var url = _apiUrl + "/api/GetUsageOfOneDay";
		var data = {};
		data.SeqSite = SeqSite;
		data.SeqMeter = SeqMeter;
		data.Year = Year;
		data.Month = Month;
		data.Day = Day;
		_apiCallPost(url, data, successCallBack, errorCallBack, async);
	}
	
	//	ì›”ê°„ ì‚¬ìš©ëŸ‰
	var _getUsageOfOneMonth = function(SeqSite, SeqMeter, Year, Month, successCallBack, errorCallBack, async){
		var url = _apiUrl + "/api/GetUsageOfOneMonth";
		var data = {};
		data.SeqSite = SeqSite;
		data.SeqMeter = SeqMeter;
		data.Year = Year;
		data.Month = Month;
		_apiCallPost(url, data, successCallBack, errorCallBack, async);
	} 
	
	//	ì—°ê°„ ì‚¬ìš©ëŸ‰
	var _getUsageOfOneYear = function(SeqSite, SeqMeter, Year, successCallBack, errorCallBack, async){
		var url = _apiUrl + "/api/GetUsageOfOneYear";
		var data = {};
		data.SeqSite = SeqSite;
		data.SeqMeter = SeqMeter;
		data.Year = Year;
		_apiCallPost(url, data, successCallBack, errorCallBack, async);
	}
	
	//	adminê´€ë¦¬ì ë¦¬ìŠ¤íŠ¸	-->	í™ˆ(bldHome, bldAlarm, popBldHome)
	var _getTeamAdminList = function(SeqSite, successCallBack, errorCallBack, async){
		var url = _apiUrl + "/api/GetTeamAdminList";
		var data = {};
		data.SeqSite = SeqSite;
		_apiCallPost(url, data, successCallBack, errorCallBack, async);
	}
	
	//	ê±´ë¬¼ ê´€ë¦¬ì ì•Œë¦¼ ì„¤ì • ì •ë³´ ì €ì¥
	var _changeAdminSettings = function(SeqAdmin, NotiKwhDaily , NotiKwhMonthly , NotiKwhYearly, NotiUsage , ThresholdKwhDaily ,
			ThresholdKwhMonthly ,ThresholdKwhYearly , UsageNotiType , UsageNotiHour, successCallBack, errorCallBack ,async ){
		var url = _apiUrl + "/api/ChangeAdminSettings";
		var data = {};
		data.SeqAdmin = SeqAdmin;
		data.NotiKwhDaily = NotiKwhDaily;
		data.NotiKwhMonthly = NotiKwhMonthly;
		data.NotiKwhYearly = NotiKwhYearly;
		data.NotiUsage = NotiUsage;
		data.ThresholdKwhDaily = ThresholdKwhDaily;
		data.ThresholdKwhMonthly = ThresholdKwhMonthly;
		data.ThresholdKwhYearly = ThresholdKwhYearly;
		data.UsageNotiType = UsageNotiType;
		data.UsageNotiHour = UsageNotiHour;
		//console.log(data);
		
		_apiCallPost(url, data, successCallBack, errorCallBack, async);
	}
	
	//	ê³µì§€ ì‚¬í•­ ìƒì„±
	var _createNotice = function (SeqAdmin, Top , WriterType , TargetType, Title , Content , successCallBack, errorCallBack, async ){
		var url = _apiUrl + "/api/CreateNotice";
		var data = {};
		data.SeqAdmin = SeqAdmin;
		data.Top = Top;
		data.WriterType = WriterType;
		data.TargetType = TargetType;
		data.Title = Title;
		data.Content = Content;
		
		_apiCallPost(url, data, successCallBack, errorCallBack, async);
	};
	
	//	ê±´ë¬¼ ê´€ë¦¬ì ëŒ€ìƒ ê³µì§€ì‚¬í•­ ëª©ë¡
	var _getBldNoticeList = function (SeqAdmin, TimeCreatedMax , CountNotice , successCallBack, errorCallBack, async ){
		var url = _apiUrl + "/api/CreateNotice";
		var data = {};
		data.SeqAdmin = SeqAdmin;
		data.TimeCreatedMax = TimeCreatedMax;
		data.CountNotice = CountNotice;
				
		_apiCallPost(url, data, successCallBack, errorCallBack, async);
	}
	
	//	ê³µì§€ì‚¬í•­ì„ ì½ì€ ìƒíƒœë¡œ ì €ì¥
	var _setBldNoticeListAsRead = function(SeqAdmin, SeqNoticeList, successCallBack, errorCallBack, async ){
		var url = _apiUrl + "/api/CreateNotice";
		var data = {};
		data.SeqAdmin = SeqAdmin;
		data.SeqNoticeList = SeqNoticeList;
				
		_apiCallPost(url, data, successCallBack, errorCallBack, async);
	}
	
	//	ê³µì§€ì‚¬í•­ ìˆ˜ì •
	var _modifyNotice = function (SeqNotice, SeqAdmin, Top, Title, Content, successCallBack, errorCallBack, async){
		var url = _apiUrl + "/api/ModifyNotice";
		var data = {};
		data.SeqNotice = SeqNotice;
		data.SeqAdmin = SeqAdmin;
		data.Top = Top;
		data.Title = Title;
		data.Content = Content;
		
				
		_apiCallPost(url, data, successCallBack, errorCallBack, async);
	}
	
	//////////////////////////////////////////////////////////////////////////////
	
	
	
	
	// í˜„ì¬ ì‚¬ìš©ëŸ‰ - ë‹¨ì§€ ê´€ë ¨ ì •ë³´ AsyncData
	var _getAdminUsageCurrentAsyncData = function(SeqAdmin){
		var _returnData = null;
		
		_getAdminUsageCurrent(SeqAdmin, function(data){
			_returnData = data;
		}, undefined, 'false');
		
		return _returnData
	}
		
	// ë³€ì••ê¸° ë‹¹ì¼ ì „ê¸° ì‚¬ìš©ëŸ‰ AsyncData
	var _getUsageOfOneDayAsyncData = function(SeqSite, SeqMeter, Year, Month, Day){
		var _returnData = null;
		
		_getUsageOfOneDay(SeqSite, SeqMeter, Year, Month, Day, function(data){
			_returnData = data;
		}, undefined, 'false');
		
		return _returnData
	}
	
	// ë³€ì••ê¸° í•´ë‹¹ ì›” ì „ê¸° ì‚¬ìš©ëŸ‰ AsyncData
	var _getUsageOfOneMonthAsyncData = function(SeqSite, SeqMeter, Year, Month){
		var _returnData = null;
		
		_getUsageOfOneMonth(SeqSite, SeqMeter, Year, Month, function(data){
			_returnData = data;
		}, undefined, 'false');
		
		return _returnData
	}
	
	// ë³€ì••ê¸° í•´ë‹¹ ë…„ ì „ê¸° ì‚¬ìš©ëŸ‰ AsyncData
	var _getUsageOfOneYearAsyncData = function(SeqSite, SeqMeter, Year){
		var _returnData = null;
		
		_getUsageOfOneYear(SeqSite, SeqMeter, Year, function(data){
			_returnData = data;
		}, undefined, 'false');
		
		return _returnData
	}
	
	//	adminê´€ë¦¬ì ë¦¬ìŠ¤íŠ¸
	var _getTeamAdminListrAsyncData = function(SeqSite){
		var _returnData = null;
		
		_getTeamAdminList(SeqSite, function(data){
			_returnData = data;
		}, undefined, 'false');
		
		return _returnData;
	}
	
	//	ê±´ë¬¼ ê´€ë¦¬ì ì•Œë¦¼ ì„¤ì • ì •ë³´ ì €ì¥
	var _changeAdminSettingsAsyncData = function(SeqAdmin, NotiKwhDaily , NotiKwhMonthly , NotiKwhYearly, NotiUsage , ThresholdKwhDaily ,
			ThresholdKwhMonthly ,ThresholdKwhYearly , UsageNotiType , UsageNotiHour){
		var _returnData = null;
		
		_changeAdminSettings(SeqAdmin, NotiKwhDaily , NotiKwhMonthly , NotiKwhYearly, NotiUsage , ThresholdKwhDaily ,
				ThresholdKwhMonthly ,ThresholdKwhYearly , UsageNotiType , UsageNotiHour, function(data){
			_returnData = data;
		}, undefined, 'false');
		
		return _returnData;
	}
	
	
	/**
	//	ê³µì§€ì‚¬í•­ ìƒì„± : ê³µì§€ì‚¬í•­ ë§Œë“¤ê¸°. TargetType ì„ ì¡°ì •í•˜ì—¬ ê±´ë¬¼ê´€ë¦¬ì ëŒ€ìƒì´ë‚˜ ì•„íŒŒíŠ¸ ì£¼ë¯¼ ëŒ€ìƒìœ¼ë¡œ ê³µì§€ì‚¬í•­ì„ ìƒì„±
	ğŸ¡¨ SeqAdmin (ì‘ì„±ì Seq), Top (0=ì¼ë°˜ê³µì§€, 1=ìƒë‹¨ê³ ì • ê³µì§€), WriterType (ì‘ì„±ìêµ¬ë¶„ : 1=ì•„íŒŒíŠ¸ê´€ë¦¬ì‹¤, 2=ì—ë„ˆë„·, 3=êµ¬ì²­ê´€ë¦¬ì),
	 TargetType (ìˆ˜ì‹ ëŒ€ìƒ : 1=ì•„íŒŒíŠ¸ì£¼ë¯¼, 2=ì•„íŒŒíŠ¸ê´€ë¦¬ì, 3=ê±´ë¬¼ê´€ë¦¬ì, 4=êµ¬ì²­ê´€ë¦¬ì), Title (ì œëª©), Content (ë‚´ìš©)
	ğŸ¡ª
	result_code : 0=ì‹¤íŒ¨, 1=ì„±ê³µ
	seq_notice_inserted : ìƒì„±ëœ ê³µì§€ì‚¬í•­ Seq ë²ˆí˜¸ 
	
	apt : ì•„íŒŒíŠ¸ ê´€ë¦¬ì 1 -> ì•„íŒŒíŠ¸ ì£¼ë¯¼ 1
	org : êµ¬ì²­ ê´€ë¦¬ì 3 -> ê±´ë¬¼ê´€ë¦¬ì 3
	 */
	var _createNoticeAsyncData = function(SeqAdmin, Top, WriterType, TargetType, Title, Content){
		var _returnData = null;
		
		_createNotice(SeqAdmin, Top , WriterType , TargetType, Title , Content , function(data){
			_returnData = data;
		}, undefined, 'false');
		
		return _returnData;
	}
	
	/**
	//	GetBldNoticeList
	ê±´ë¬¼ê´€ë¦¬ì ëŒ€ìƒ ê³µì§€ì‚¬í•­ ëª©ë¡
	ğŸ¡¨ SeqAdmin (ê±´ë¬¼ê´€ë¦¬ì Seq / ê³µì§€ì‚¬í•­ ì½ìŒ ì—¬ë¶€ íŒë‹¨ìš©), TimeCreatedMax (ì§€ì •í•œ ì‹œê°„ ì´ì „ì˜ ê³µì§€ì‚¬í•­ ì˜ˆ = 20191013162045), CountNotice (ë¦¬í„´í•  ê³µì§€ì‚¬í•­ ìµœëŒ€ ê°¯ìˆ˜)
	ğŸ¡ª
	[notice_top_list]
	ê³µì§€ì‚¬í•­ ìƒë‹¨ ê³ ì • ëª©ë¡
	notice_type : ê³µì§€ì‚¬í•­ ì‘ì„±ì ì¢…ë¥˜ (1=ì•„íŒŒíŠ¸ê´€ë¦¬ì‹¤, 2=ì—ë„ˆë„·, 3=êµ¬ì²­ê´€ë¦¬ì)
	time_read : null ì´ë©´ ì½ì§€ ì•Šì€ ê³µì§€ì‚¬í•­
	[notice_list]
	ì¼ë°˜ ê³µì§€ì‚¬í•­ ëª©ë¡
	notice_type : ê³µì§€ì‚¬í•­ ì‘ì„±ì ì¢…ë¥˜ (1=ì•„íŒŒíŠ¸ê´€ë¦¬ì‹¤, 2=ì—ë„ˆë„·, 3=êµ¬ì²­ê´€ë¦¬ì)
	time_read : null ì´ë©´ ì½ì§€ ì•Šì€ ê³µì§€ì‚¬í•­
	 */
	var _getBldNoticeListAsyncData = function(SeqAdmin, TimeCreatedMax, CountNotice){
		var _returnData = null;
		
		_getBldNoticeList(SeqAdmin, TimeCreatedMax , CountNotice , function(data){
			_returnData = data;
		}, undefined, 'false');
		
		return _returnData;
	}
	
	/**
	[SetBldNoticeListAsRead]
	ê³µì§€ì‚¬í•­ seq ë²ˆí˜¸ë¡œ ì§€ì •í•œ ê³µì§€ì‚¬í•­ì„ ì½ì€ ìƒíƒœë¡œ ì €ì¥
	ğŸ¡¨ SeqAdmin, SeqNoticeList (ì½¤ë§ˆë¡œ ë¶„ë¦¬ëœ seq_notice ëª©ë¡, ì˜ˆì‹œ 14,16,20)
	ğŸ¡ª
	result_code : 0/1
	 */
	var _setBldNoticeListAsReadAsyncData = function(SeqAdmin, SeqNoticeList){
		var _returnData = null;
		
		_setBldNoticeListAsRead(SeqAdmin, SeqNoticeList, function(data){
			_returnData = data;
		}, undefined, 'false');
		
		return _returnData;
	}
	
	
	/**
	[ModifyNotice]
	ê³µì§€ì‚¬í•­ ìˆ˜ì •í•˜ê¸°.
	SeqNotice, SeqAdmin (ìˆ˜ì •ì Seq), Top (0=ì¼ë°˜ê³µì§€, 1=ìƒë‹¨ê³ ì • ê³µì§€), Title (ì œëª©), Content (ë‚´ìš©)
	result_code : 0=ì‹¤íŒ¨, 1=ì„±ê³µ
	 */
	var _modifyNoticeAsyncData = function(SeqNotice, SeqAdmin, Top, Title, Content){
		var _returnData = null;
		
		_modifyNotice(SeqNotice, SeqAdmin, Top, Title, Content, function(data){
			_returnData = data;
		}, undefined, 'false');
		
		return _returnData;
	}
	
	///////////////////////////////////////////////////////////////////	
	//	
	
	
	//	êµ¬ì²­ìš© ->	dashboard	||	Home
	//	ì˜¤ëŠ˜ ì‚¬ìš©ëŸ‰, 30ì¼ í‰ê·  ì‚¬ìš©ëŸ‰, ì‚¬ìš©ëŸ‰ ë¹„êµ, CO2 ë°œìƒëŸ‰ | ê·¸ë˜í”„ ë°ì´í„°
	var _getTeamUsageFront = function(SeqTeam, Year, Month, Day){
		var _returnData = null; 
		var _url = _apiUrl+"/api/GetTeamUsageFront";
		
		var _data = {};
		_data.SeqTeam = SeqTeam;
		_data.Year = Year;
		_data.Month = Month;
		_data.Day = Day; 
		
		_apiCallPost(_url, _data, function(data){
			_returnData = data;
		}, undefined, 'false');
		
		return _returnData;
	}
	
	
	//	ì‹œì„¤ë¬¼ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜
	var _getAdminInfo = function(SeqAdmin){
		var _returnData = null;
		var _url = _apiUrl+"/api/GetAdminInfo";
		
		var _data = {}
		_data.SeqAdmin = SeqAdmin;
		
		_apiCallPost(_url, _data, function(data){
			_returnData = data;
		}, undefined, 'false');
		
		return _returnData;
	}
	
	/*//	ì‹œì„¤ë³„ ì‚¬ìš©ëŸ‰ì„ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜
	var _getSiteUsageDay = function(SeqSite, Year, Month, Day){
		var _returnData = null;
		var _url = _apiUrl+"/api/GetSiteUsageDay";
		
		var _data = {}
		_data.SeqSite = SeqSite;
		_data.Year = Year;
		_data.Month = Month;
		_data.Day = Day;
		
		_apiCallPost(_url, _data, function(data){
			_returnData = data;
		}, undefined, 'false');
		
		return _returnData;
	}*/
	
	//	ì‹œì„¤ë³„ ì‚¬ìš©ëŸ‰ì„ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜
	var _getSiteUsageFront = function(SeqSite, Year, Month, Day){
		var _returnData = null;
		var _url = _apiUrl+"/api/GetSiteUsageFront";
		
		var _data = {}
		_data.SeqSite = SeqSite;
		_data.Year = Year;
		_data.Month = Month;
		_data.Day = Day;
		
		_apiCallPost(_url, _data, function(data){
			_returnData = data;
		}, undefined, 'false');
		
		return _returnData;
	}
	

	//	ì‚¬ì´íŠ¸ì˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜´
	//	seq_site : ë‹¨ì§€Seq ë²ˆí˜¸
	var _getSiteInfoBld = function(SeqSite){
		var _returnData = null;
		var _url = _apiUrl + "/api/GetSiteInfoBld";
		var _data = {};
		_data.SeqSite = SeqSite;
		
		_apiCallPost(_url, _data, function(data){
			_returnData = data;
		}, undefined, 'false');
		
		return _returnData;
	}
	
	
	
	return {
		
		getAdminUsageCurrentAsyncData : _getAdminUsageCurrentAsyncData,
		getUsageOfOneDayAsyncData : _getUsageOfOneDayAsyncData,
		getUsageOfOneMonthAsyncData : _getUsageOfOneMonthAsyncData,
		getUsageOfOneYearAsyncData : _getUsageOfOneYearAsyncData,
		getTeamAdminListrAsyncData : _getTeamAdminListrAsyncData,
		changeAdminSettingsAsyncData : _changeAdminSettingsAsyncData,
		createNoticeAsyncData : _createNoticeAsyncData,
		setBldNoticeListAsReadAsyncData : _setBldNoticeListAsReadAsyncData,
		modifyNoticeAsyncData : _modifyNoticeAsyncData,
		getTeamUsageFront : _getTeamUsageFront,
		getAdminInfo : _getAdminInfo,
		/*getSiteUsageDay : _getSiteUsageDay,*/
		getSiteInfoBld : _getSiteInfoBld,
		getSiteUsageFront : _getSiteUsageFront,
		ajaxCall: _ajaxCall
		
	};
}();



